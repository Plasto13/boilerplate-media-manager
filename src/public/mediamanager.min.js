function loadPath(e){$.ajax({url:routes.ajaxList,type:"post",data:{path:e,mce:$("#media-content").data("mce"),display:$("#media-content").data("display"),type:$("#media-content").data("type")},beforeSend:function(){$("#loading").css({position:"absolute",display:"flex",width:$("#media-content").width(),height:0===$("#media-content").height()?200:$("#media-content").height()})},complete:function(){$("#loading").css("display","none")},success:function(t){$("#media-content").html(t),$("#media-content").data("path",$("#media-list").data("path")),$(".lazy").lazy(),$('#media-list input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_square-blue"}),showMove(),uploadButton(e)}})}function uploadButton(e){$("#fileupload").fileupload({dataType:"json",formData:{path:e},url:routes.ajaxUpload,start:function(){$("#disable,#progress").show()},progressall:function(e,t){var a=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",a+"%").text(a+"%")},fail:function(e,t){var a=t.files[0].name+" : "+t.jqXHR.responseJSON.error;growl(a,"danger")},always:function(t,a){"error"===a.jqXHR.responseJSON.status&&growl(a.files[0].name+" : "+a.jqXHR.responseJSON.error,"danger"),1===$("#fileupload").fileupload("active")&&(growl(locales.uploadSuccess,"success"),$("#disable").hide(),loadPath(e))}})}function showMove(){clipboard.files.length>0&&($("#nb-files-selected").text(clipboard.files.length),$("#btn-paste-group").show(),$("#media-content .box-header").addClass("blur"),$(".btn-paste").attr("disabled",!0),clipboard.path!==$("#media-list").data("path")&&$(".btn-paste").attr("disabled",!1))}$(function(){localStorage.getItem("mediamanager_list_display")&&$("#media-content").attr("data-display",localStorage.getItem("mediamanager_list_display")),$(document).on("click",".link-media",function(e){e.preventDefault(),1===$("#media-content").data("mce")&&void 0!==parent.tinymce?window.parent.postMessage({mceAction:"insertMedia",url:$(this).attr("href"),name:$(this).attr("data-filename")},"*"):$(this).closest(".media").find('input[type="checkbox"]').iCheck("toggle")}),$(document).on("click",".btn-refresh",function(e){e.preventDefault(),loadPath($("#media-content").data("path"))}),$(document).on("ifChanged",".check-all",function(){!0===$(this).iCheck("udpate")[0].checked?$('.media input[type="checkbox"]').iCheck("check"):$('.media input[type="checkbox"]').iCheck("unCheck")}),$(document).on("ifToggled",'.media input[type="checkbox"]',function(e){var t=!1;$('.media input[type="checkbox"]').each(function(e,a){!0===$(a).parent().iCheck("update")[0].checked&&(t=!0)}),$(".delete-checked, .copy-checked").attr("disabled",!t),t||$(".check-all").iCheck("unCheck");var a=$('.media div.checked input[type="checkbox"]');clipboard.path=$("#media-list").data("path"),clipboard.files=[],a.each(function(e,t){clipboard.files.push($(t).val())})}),$(document).on("click",".delete-checked:enabled",function(e){e.preventDefault(),bootbox.confirm(locales.deleteConfirm,function(e){!1!==e&&($("#disable").show(),$.ajax({url:routes.ajaxDelete,type:"post",data:{path:clipboard.path,files:clipboard.files},success:function(e){"success"===e.status?(growl(locales.deleteSuccess,"success"),$("#disable").hide(),$(clipboard.files).each(function(e,t){$('.media[data-filename="'+t+'"]').remove()}),clipboard.files=[]):growl(e.message,"error")}}))})}),$(document).on("click",".copy-checked:enabled",function(e){e.preventDefault(),$("#nb-files-selected").text(clipboard.files.length),$("#btn-paste-group").show()}),$(document).on("click",".btn-paste",function(e){e.preventDefault(),$.ajax({url:routes.ajaxPaste,type:"post",data:{destination:$("#media-list").data("path"),from:clipboard.path,files:clipboard.files},success:function(e){"success"===e.status?(loadPath($("#media-list").data("path")),growl(locales.pasteSuccess,"success"),clipboard.files=[]):growl(e.message,"error")}})}),$(document).on("click",".btn-paste-cancel",function(e){e.preventDefault(),clipboard.files=[],$("#btn-paste-group").hide()}),$(document).on("click",".btn-delete",function(e){e.preventDefault(),e.stopPropagation();var t=$("#media-content").data("path"),a=$(this).attr("data-filename"),o=[];o.push(a),bootbox.confirm(locales.deleteConfirm,function(e){!1!==e&&$.ajax({url:routes.ajaxDelete,type:"post",data:{path:t,files:o},success:function(){growl(locales.deleteSuccess,"success"),$(o).each(function(e,t){$('.media[data-filename="'+t+'"]').remove()})}})})}),$(document).on("click","a.add-folder",function(e){e.preventDefault();var t=$("#media-content").data("path");bootbox.prompt(locales.folderName,function(e){null!==e&&""!==e&&$.ajax({url:routes.newFolder,type:"post",data:{path:t,name:e},success:function(){growl(locales.folderSuccess,"success"),loadPath(t)}})})}),$(document).on("click",".btn-toggle-display",function(e){e.preventDefault(),$(".btn-toggle-display").toggleClass("btn-secondary").toggleClass("btn-default"),$("#media-content").data("display",$(this).data("display")),localStorage.setItem("mediamanager_list_display",$(this).data("display")),loadPath($("#media-content").data("path"))}),$(document).on("click",".btn-rename",function(e){e.preventDefault(),e.stopPropagation();var t=$("#media-content").data("path"),a=$(this).attr("data-filename");bootbox.prompt({title:locales.renameTitle,value:a,callback:function(e){null!==e&&""!==e&&$.ajax({url:routes.rename,type:"post",data:{path:t,fileName:a,newName:e},success:function(e){"success"===e.status?growl(locales.renameSuccess,"success"):growl(e.message,"danger"),loadPath(t)}})}})}),$(document).on("click",".btn-view",function(e){e.preventDefault(),e.stopPropagation(),window.open($(this).attr("href"),"_blank")}),$(document).on("click","#media-breadcrumb a, #media-list a.link-folder",function(e){e.preventDefault();var t=$(this).attr("href");history.pushState({page:t},"",t),loadPath(t)}),$(window).on("popstate",function(){loadPath(location.pathname)}),loadPath(window.location.pathname)});
